"use strict";(self.webpackChunk_castore_docs_docusaurus=self.webpackChunk_castore_docs_docusaurus||[]).push([[1820],{33259:(e,t,r)=>{r.r(t),r.d(t,{default:()=>F});var n=r(83545),o=r(85837),i=r(10230),a=r(2784),s=r(67927),c=r(42495),u=r(80457),v=r(2159),d=r(21617),p=r.n(d),l=r(33548),f=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t},g=(0,c.Z)((function e(t){var r=this,n=t.commandId,o=t.requiredEventStores,i=t.eventAlreadyExistsRetries,a=void 0===i?2:i,c=t.onEventAlreadyExists,d=void 0===c?(0,s.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return e()})));case 1:case"end":return e.stop()}}),e)}))):c,f=t.handler;(0,u.Z)(this,e),(0,v.Z)(this,"_types",void 0),(0,v.Z)(this,"commandId",void 0),(0,v.Z)(this,"requiredEventStores",void 0),(0,v.Z)(this,"eventAlreadyExistsRetries",void 0),(0,v.Z)(this,"onEventAlreadyExists",void 0),(0,v.Z)(this,"handler",void 0),this.commandId=n,this.requiredEventStores=o,this.eventAlreadyExistsRetries=a,this.onEventAlreadyExists=d,this.handler=function(){var e=(0,s.Z)(p().mark((function e(t,n){var o,i,a,s,c,u,v=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=r.eventAlreadyExistsRetries,i=1,a=v.length,s=new Array(a>2?a-2:0),c=2;c<a;c++)s[c-2]=v[c];case 3:if(!(o>=0)){e.next=23;break}return e.prev=4,e.next=7,f.apply(void 0,[t,n].concat(s));case 7:return u=e.sent,e.abrupt("return",u);case 11:if(e.prev=11,e.t0=e.catch(4),(0,l._)(e.t0)){e.next=15;break}throw e.t0;case 15:return e.next=17,r.onEventAlreadyExists(e.t0,{attemptNumber:i,retriesLeft:o});case 17:if(0!==o){e.next=19;break}throw e.t0;case 19:o-=1,i+=1;case 21:e.next=3;break;case 23:throw new Error("Handler failed to execute");case 24:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,r){return e.apply(this,arguments)}}()})),h=r(61217),m=r(95313),y=r(90379),S=r(3532),Z=r(33353),E=r(42335);function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,Z.Z)(e);if(t){var o=(0,Z.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.Z)(this,r)}}var I=function(e){(0,y.Z)(r,e);var t=x(r);function r(e){var n=e.aggregateId,o=e.eventStoreId;return(0,u.Z)(this,r),t.call(this,"Unable to find aggregate ".concat(n," in event store ").concat(o,"."))}return(0,c.Z)(r)}((0,E.Z)(Error)),b=r(65582);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,Z.Z)(e);if(t){var o=(0,Z.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.Z)(this,r)}}var w=function(e){(0,y.Z)(r,e);var t=j(r);function r(e){var n,o=e.eventStoreId;return(0,u.Z)(this,r),n=t.call(this,"Storage Adapter undefined for event store ".concat(o," ")),(0,v.Z)((0,b.Z)(n),"eventStoreId",void 0),n.eventStoreId=o,n}return(0,c.Z)(r)}((0,E.Z)(Error)),O=["aggregate","lastEvent"];function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){(0,v.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var k=(0,c.Z)((function e(t){var r=this,n=t.eventStoreId,o=t.eventStoreEvents,i=t.reduce,a=t.simulateSideEffect,c=void 0===a?function(e,t){return P(P({},e),{},(0,v.Z)({},t.version,t))}:a,d=t.storageAdapter;(0,u.Z)(this,e),(0,v.Z)(this,"_types",void 0),(0,v.Z)(this,"eventStoreId",void 0),(0,v.Z)(this,"eventStoreEvents",void 0),(0,v.Z)(this,"reduce",void 0),(0,v.Z)(this,"simulateSideEffect",void 0),(0,v.Z)(this,"getEvents",void 0),(0,v.Z)(this,"pushEvent",void 0),(0,v.Z)(this,"groupEvent",void 0),(0,v.Z)(this,"listAggregateIds",void 0),(0,v.Z)(this,"buildAggregate",void 0),(0,v.Z)(this,"getAggregate",void 0),(0,v.Z)(this,"getExistingAggregate",void 0),(0,v.Z)(this,"simulateAggregate",void 0),(0,v.Z)(this,"storageAdapter",void 0),(0,v.Z)(this,"getStorageAdapter",void 0),this.eventStoreId=n,this.eventStoreEvents=o,this.reduce=i,this.simulateSideEffect=c,this.storageAdapter=d,this.getStorageAdapter=function(){if(!r.storageAdapter)throw new w({eventStoreId:r.eventStoreId});return r.storageAdapter},this.getEvents=function(e,t){return r.getStorageAdapter().getEvents(e,{eventStoreId:r.eventStoreId},t)},this.pushEvent=function(){var e=(0,s.Z)(p().mark((function e(t){var n,o,i,a,s,c=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(c.length>1&&void 0!==c[1]?c[1]:{}).prevAggregate,o=r.getStorageAdapter(),e.next=4,o.pushEvent(t,{eventStoreId:r.eventStoreId});case 4:return i=e.sent,a=i.event,s=void 0,(n||1===a.version)&&(s=r.reduce(n,a)),e.abrupt("return",P({event:a},s?{nextAggregate:s}:{}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.groupEvent=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).prevAggregate,n=r.getStorageAdapter().groupEvent(e);return n.eventStore=r,n.context={eventStoreId:r.eventStoreId},void 0!==t&&(n.prevAggregate=t),n},this.listAggregateIds=function(e){return r.getStorageAdapter().listAggregateIds({eventStoreId:r.eventStoreId},e)},this.buildAggregate=function(e,t){return e.reduce(r.reduce,t)},this.getAggregate=function(){var e=(0,s.Z)(p().mark((function e(t){var n,o,i,a,s,c=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(c.length>1&&void 0!==c[1]?c[1]:{}).maxVersion,e.next=3,r.getEvents(t,{maxVersion:n});case 3:return o=e.sent,i=o.events,a=r.buildAggregate(i,void 0),s=i[i.length-1],e.abrupt("return",{aggregate:a,events:i,lastEvent:s});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getExistingAggregate=function(){var e=(0,s.Z)(p().mark((function e(t,n){var o,i,a,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getAggregate(t,n);case 2:if(o=e.sent,i=o.aggregate,a=o.lastEvent,s=(0,m.Z)(o,O),void 0!==i&&void 0!==a){e.next=8;break}throw new I({aggregateId:t,eventStoreId:r.eventStoreId});case 8:return e.abrupt("return",P({aggregate:i,lastEvent:a},s));case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.simulateAggregate=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).simulationDate,n=Object.values(e.reduce(r.simulateSideEffect,{}));void 0!==t&&(n=n.filter((function(e){return e.timestamp<=t})));var o=n.sort((function(e,t){return e.timestamp<t.timestamp?-1:1})).map((function(e,t){return P(P({},e),{},{version:t+1})}));return r.buildAggregate(o)}}));(0,v.Z)(k,"pushEventGroup",(0,s.Z)(p().mark((function e(){var t,r,n,o,i,a,s,c,u=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,n=new Array(r),o=0;o<r;o++)n[o]=u[o];return i=n[0],a=n.slice(1),e.next=4,(t=i.eventStorageAdapter).pushEventGroup.apply(t,[i].concat((0,h.Z)(a)));case 4:return s=e.sent,c=s.eventGroup,e.abrupt("return",{eventGroup:c.map((function(e,t){var r=e.event,o=n[t],i=void 0,a=null==o?void 0:o.prevAggregate;return!a&&1!==r.version||void 0===(null==o?void 0:o.eventStore)||(i=o.eventStore.reduce(a,r)),P({event:r},i?{nextAggregate:i}:{})}))});case 7:case"end":return e.stop()}}),e)}))));var R=(0,c.Z)((function e(t){var r=t.type,n=t.payloadSchema,o=t.metadataSchema;(0,u.Z)(this,e),(0,v.Z)(this,"_types",void 0),(0,v.Z)(this,"type",void 0),(0,v.Z)(this,"payloadSchema",void 0),(0,v.Z)(this,"metadataSchema",void 0),this.type=r,this.payloadSchema=n,this.metadataSchema=o})),B=new R({type:"APPEARED",payloadSchema:{type:"object",properties:{name:{type:"string"},level:{type:"number"}},required:["name","level"],additionalProperties:!1},metadataSchema:{type:"object",properties:{trigger:{enum:["random","scripted"]}},additionalProperties:!1}}),D=new R({type:"CATCHED_BY_TRAINER",payloadSchema:{type:"object",properties:{trainerId:{type:"string"}},required:["trainerId"],additionalProperties:!1}}),N=new R({type:"LEVELLED_UP"});function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,v.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var C=new k({eventStoreId:"POKEMONS",eventStoreEvents:[B,D,N],reduce:function(e,t){var r=t.version,n=t.aggregateId;switch(t.type){case"APPEARED":var o=t.payload,i=o.name,a=o.level;return{aggregateId:n,version:t.version,name:i,level:a,status:"wild"};case"CATCHED_BY_TRAINER":var s=t.payload.trainerId;return _(_({},e),{},{version:r,status:"catched",trainerId:s});case"LEVELLED_UP":return _(_({},e),{},{version:r,level:e.level+1})}}}),L=new R({type:"GAME_STARTED",payloadSchema:{type:"object",properties:{trainerName:{type:"string"}},required:["trainerName"],additionalProperties:!1}}),M=new R({type:"POKEMON_CATCHED",payloadSchema:{type:"object",properties:{pokemonId:{type:"string",format:"uuid"}},required:["pokemonId"],additionalProperties:!1}});function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){(0,v.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var G=new k({eventStoreId:"TRAINERS",eventStoreEvents:[L,M],reduce:function(e,t){var r=t.version,n=t.aggregateId;switch(t.type){case"GAME_STARTED":var o=t.payload.trainerName;return{aggregateId:n,version:t.version,name:o,catchedPokemonIds:[],catchedPokemonsCount:0};case"POKEMON_CATCHED":var i=t.payload.pokemonId;return K(K({},e),{},{version:r,catchedPokemonIds:[].concat((0,h.Z)(e.catchedPokemonIds),[i]),catchedPokemonsCount:e.catchedPokemonsCount+1})}}}),U=r(91715);function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,Z.Z)(e);if(t){var o=(0,Z.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.Z)(this,r)}}var H,Y=function(e){(0,y.Z)(r,e);var t=V(r);function r(e){var n,o=e.commandId,i=e.requiredEventStores,a=e.eventAlreadyExistsRetries,s=e.onEventAlreadyExists,c=e.handler,d=e.inputSchema,p=e.outputSchema;return(0,u.Z)(this,r),n=t.call(this,{commandId:o,requiredEventStores:i,eventAlreadyExistsRetries:a,onEventAlreadyExists:s,handler:c}),(0,v.Z)((0,b.Z)(n),"inputSchema",void 0),(0,v.Z)((0,b.Z)(n),"outputSchema",void 0),void 0!==d&&(n.inputSchema=d),void 0!==p&&(n.outputSchema=p),n}return(0,c.Z)(r)}(g),J=new Y({commandId:"START_POKEMON_GAME",requiredEventStores:f(G),inputSchema:{type:"object",properties:{trainerName:{type:"string"}},required:["trainerName"],additionalProperties:!1},outputSchema:{type:"object",properties:{trainerId:{type:"string"}},required:["trainerId"],additionalProperties:!1},handler:(H=(0,s.Z)(p().mark((function e(t,r,n){var o,i,a,s,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.generateUuid,i=t.trainerName,a=(0,U.Z)(r,1),s=a[0],c=o(),e.next=6,s.pushEvent({aggregateId:c,version:1,type:"GAME_STARTED",payload:{trainerName:i}});case 6:return e.abrupt("return",{trainerId:c});case 7:case"end":return e.stop()}}),e)}))),function(e,t,r){return H.apply(this,arguments)})}),W=new Y({commandId:"WILD_POKEMON_APPEAR",requiredEventStores:f(C),inputSchema:{type:"object",properties:{pokemonName:{type:"string"},pokemonLevel:{type:"number"}},required:["pokemonName","pokemonLevel"],additionalProperties:!1},outputSchema:{type:"object",properties:{pokemonId:{type:"string"}},required:["pokemonId"],additionalProperties:!1},handler:function(){var e=(0,s.Z)(p().mark((function e(t,r,n){var o,i,a,s,c,u;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.generateUuid,i=t.pokemonName,a=t.pokemonLevel,s=(0,U.Z)(r,1),c=s[0],u=o(),e.next=6,c.pushEvent({aggregateId:u,version:1,type:"APPEARED",payload:{name:i,level:a},metadata:{trigger:"random"}});case 6:return e.abrupt("return",{pokemonId:u});case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}),z=new Y({commandId:"CATCH_POKEMON",requiredEventStores:f(C,G),inputSchema:{type:"object",properties:{pokemonId:{type:"string"},trainerId:{type:"string"}},required:["pokemonId","trainerId"],additionalProperties:!1},handler:function(){var e=(0,s.Z)(p().mark((function e(t,r){var n,o,i,a,s,c,u,v,d,l,f;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.pokemonId,o=t.trainerId,i=(0,U.Z)(r,2),a=i[0],s=i[1],e.next=4,Promise.all([a.getAggregate(n),s.getAggregate(o)]);case 4:if(c=e.sent,u=(0,U.Z)(c,2),v=u[0].aggregate,d=u[1].aggregate,void 0!==v){e.next=10;break}throw new Error("Pokemon not found");case 10:if(void 0!==d){e.next=12;break}throw new Error("Trainer not found");case 12:if(l=v.version,"catched"!==v.status){e.next=15;break}throw new Error("Pokemon already catched");case 15:return f=d.version,e.next=18,k.pushEventGroup(a.groupEvent({aggregateId:n,version:l+1,type:"CATCHED_BY_TRAINER",payload:{trainerId:o}}),s.groupEvent({aggregateId:o,version:f+1,type:"POKEMON_CATCHED",payload:{pokemonId:n}}));case 18:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),$=new Y({commandId:"LEVEL_UP_POKEMON",requiredEventStores:f(C),inputSchema:{type:"object",properties:{pokemonId:{type:"string"}},required:["pokemonId"],additionalProperties:!1},outputSchema:{type:"object",properties:{nextLevel:{type:"number"}},required:["nextLevel"],additionalProperties:!1},handler:function(){var e=(0,s.Z)(p().mark((function e(t,r){var n,o,i,a,s,c,u,v;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.pokemonId,o=(0,U.Z)(r,1),i=o[0],e.next=4,i.getAggregate(n);case 4:if(a=e.sent,void 0!==(s=a.aggregate)){e.next=8;break}throw new Error("Pokemon not found");case 8:if(c=s.version,99!==s.level){e.next=11;break}throw new Error("Pokemon level maxed out");case 11:return e.next=13,i.pushEvent({aggregateId:n,version:c+1,type:"LEVELLED_UP"},{prevAggregate:s});case 13:if(u=e.sent,v=u.nextAggregate){e.next=17;break}throw new Error;case 17:return e.abrupt("return",{nextLevel:v.level});case 18:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()});function F(){const{siteConfig:e}=(0,o.Z)();return a.createElement(i.Z,{title:`Hello from ${e.title}`,description:"Description will go into a meta tag in <head />"},a.createElement(n.Z,null,(()=>{const e=r(45111).YA,t=r(60130).v4;return a.createElement(e,{eventStores:[C,G],commands:f(J,W,z,$),contextsByCommandId:{START_POKEMON_GAME:[{generateUuid:t}],WILD_POKEMON_APPEAR:[{generateUuid:t}]}})})))}},33548:(e,t,r)=>{r.d(t,{P:()=>o,_:()=>i});var n=r(74037),o="EventAlreadyExistsError",i=function(e){return"object"===(0,n.Z)(e)&&null!==e&&"code"in e&&e.code===o}},45111:(e,t,r)=>{r.d(t,{YA:()=>we});var n=r(38472),o=r(12590),i=r(2784),a=r(43997),s=r(4012),c=r(61217),u=r(95313),v=r(67927),d=r(42495),p=r(80457),l=r(2159),f=r(21617),g=r.n(f),h=(0,d.Z)((function e(t){var r=t.event,n=t.context,o=t.prevAggregate,i=t.eventStorageAdapter,a=t.eventStore;(0,p.Z)(this,e),(0,l.Z)(this,"_types",void 0),(0,l.Z)(this,"event",void 0),(0,l.Z)(this,"context",void 0),(0,l.Z)(this,"prevAggregate",void 0),(0,l.Z)(this,"eventStorageAdapter",void 0),(0,l.Z)(this,"eventStore",void 0),this.event=r,void 0!==n&&(this.context=n),void 0!==o&&(this.prevAggregate=o),this.eventStorageAdapter=i,void 0!==a&&(this.eventStore=a)})),m=r(65582),y=r(90379),S=r(3532),Z=r(33353),E=r(42335);function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,Z.Z)(e);if(t){var o=(0,Z.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.Z)(this,r)}}var I=function(e){(0,y.Z)(r,e);var t=x(r);function r(e){var n,o=e.eventStoreSliceName;return(0,p.Z)(this,r),n=t.call(this,"Unable to find redux slice at path ".concat(o)),(0,l.Z)((0,m.Z)(n),"eventStoreSliceName",void 0),n.eventStoreSliceName=o,n}return(0,d.Z)(r)}((0,E.Z)(Error)),b=r(33548);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,Z.Z)(e);if(t){var o=(0,Z.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.Z)(this,r)}}var w=function(e){(0,y.Z)(r,e);var t=j(r);function r(e){var n,o=e.eventStoreId,i=void 0===o?"":o,a=e.aggregateId,s=e.version;return(0,p.Z)(this,r),n=t.call(this,"Event already exists for ".concat(i," aggregate ").concat(a," and version ").concat(s)),(0,l.Z)((0,m.Z)(n),"code",void 0),(0,l.Z)((0,m.Z)(n),"eventStoreId",void 0),(0,l.Z)((0,m.Z)(n),"aggregateId",void 0),(0,l.Z)((0,m.Z)(n),"version",void 0),n.code=b.P,i&&(n.eventStoreId=i),n.aggregateId=a,n.version=s,n}return(0,d.Z)(r)}((0,E.Z)(Error)),O="@castore",A=function(e){var t=e.prefix;return[void 0===t?O:t,e.eventStoreId].join("_")},P=function(e){var t,r,n,o,i=e.inputOptions,a=e.inputPageToken,s={};if("string"==typeof a)try{s=JSON.parse(a)}catch(c){throw new Error("Invalid page token")}return{limit:null!==(t=null==i?void 0:i.limit)&&void 0!==t?t:s.limit,initialEventAfter:null!==(r=null==i?void 0:i.initialEventAfter)&&void 0!==r?r:s.initialEventAfter,initialEventBefore:null!==(n=null==i?void 0:i.initialEventBefore)&&void 0!==n?n:s.initialEventBefore,reverse:null!==(o=null==i?void 0:i.reverse)&&void 0!==o?o:s.reverse,exclusiveStartKey:s.lastEvaluatedKey}},k=["pageToken"];function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,l.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D,N=(0,d.Z)((function e(t){var r=this,n=t.store,o=t.eventStoreId,i=t.prefix;(0,p.Z)(this,e),(0,l.Z)(this,"getEvents",void 0),(0,l.Z)(this,"pushEvent",void 0),(0,l.Z)(this,"pushEventGroup",void 0),(0,l.Z)(this,"groupEvent",void 0),(0,l.Z)(this,"listAggregateIds",void 0),(0,l.Z)(this,"putSnapshot",void 0),(0,l.Z)(this,"getLastSnapshot",void 0),(0,l.Z)(this,"listSnapshots",void 0),(0,l.Z)(this,"store",void 0),(0,l.Z)(this,"eventStoreId",void 0),(0,l.Z)(this,"eventStoreSliceName",void 0),(0,l.Z)(this,"getEventStoreState",void 0),this.store=n,this.eventStoreId=o,this.eventStoreSliceName=A({eventStoreId:o,prefix:i}),this.getEventStoreState=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.eventStoreSliceName,t=r.store.getState()[e];if(void 0===t)throw new I({eventStoreSliceName:e});return t},this.pushEvent=function(){var e=(0,v.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n,o=(new Date).toISOString(),i=B(B({},t),{},{timestamp:o}),a=i.aggregateId;if((null!==(n=r.getEventStoreState().eventsByAggregateId[a])&&void 0!==n?n:[]).some((function(e){return e.version===i.version})))throw new w({eventStoreId:r.eventStoreId,aggregateId:i.aggregateId,version:i.version});r.store.dispatch({type:"".concat(r.eventStoreSliceName,"/eventPushed"),payload:i}),e({event:i})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.pushEventGroup=function(){return new Promise((function(e,t){return t(new Error("Event groups are not supported yet in Redux event storage"))}))},this.groupEvent=function(e){return new h({event:e,eventStorageAdapter:r})},this.getEvents=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.minVersion,i=n.maxVersion,a=n.reverse,s=n.limit;return new Promise((function(t){var n,c=null!==(n=r.getEventStoreState().eventsByAggregateId[e])&&void 0!==n?n:[];void 0!==o&&(c=c.filter((function(e){return e.version>=o}))),void 0!==i&&(c=c.filter((function(e){return e.version<=i}))),!0===a&&(c=c.reverse()),void 0!==s&&(c=c.slice(0,s)),t({events:c})}))},this.listAggregateIds=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.pageToken,o=(0,u.Z)(t,k);return new Promise((function(e){var t=r.getEventStoreState(),i=P({inputPageToken:n,inputOptions:o}),a=i.limit,s=i.initialEventAfter,u=i.initialEventBefore,v=i.reverse,d=i.exclusiveStartKey,p=(0,c.Z)(t.aggregateIds).sort((function(e,t){return e.initialEventTimestamp>t.initialEventTimestamp?1:-1}));void 0!==s&&(p=p.filter((function(e){var t=e.initialEventTimestamp;return s<=t}))),void 0!==u&&(p=p.filter((function(e){return e.initialEventTimestamp<=u})));var l=p.map((function(e){return e.aggregateId}));if(!0===v&&(l=l.reverse()),void 0!==d){var f=l.findIndex((function(e){return e===d}));l=l.slice(f+1)}var g=l.length;void 0!==a&&(l=l.slice(0,a));var h=void 0!==a&&g>a,m={limit:a,initialEventAfter:s,initialEventBefore:u,reverse:v,lastEvaluatedKey:l[l.length-1]};e(B({aggregateIds:l},h?{nextPageToken:JSON.stringify(m)}:{}))}))},this.putSnapshot=function(){return new Promise((function(e){return e()}))},this.getLastSnapshot=function(){return new Promise((function(e){return e({snapshot:void 0})}))},this.listSnapshots=function(){return new Promise((function(e){return e({snapshots:[]})}))}})),T=function(e){var t=e.eventStores,r=e.prefix,n=void 0===r?O:r,o=function(e){var t=e.prefix,r=void 0===t?O:t,n=e.eventStores,o={};return n.forEach((function(e){var t=e.eventStoreId,n=A({prefix:r,eventStoreId:t}),i=(0,s.oM)({name:n,initialState:{eventsByAggregateId:{},aggregateIds:[]},reducers:{eventPushed:function(e,t){var r=t.payload,n=r.aggregateId,o=r.timestamp,i=e.eventsByAggregateId[n];void 0===i?(e.eventsByAggregateId[n]=[r],e.aggregateIds.push({aggregateId:n,initialEventTimestamp:o})):i.push(r)}}}).reducer;o[n]=i})),o}({eventStores:t,prefix:n}),i=(0,s.xC)({reducer:o});return t.forEach((function(e){e.storageAdapter=new N({store:i,eventStoreId:e.eventStoreId,prefix:n})})),i},_=r(91715),C=r(44434),L=r(58112),M=r(72137),q=r(78287),K=r(33927),G=r(63655),U=r(20597),V=r(2995),H=r(62197),Y=r(35322),J=r(10248),W=r(31789).ZP,z=r(52322),$=function(e){var t=e.command,r=e.eventStoresById,n=e.contextsByCommandId,o=t.commandId,i=t.inputSchema,a=t.requiredEventStores,s=t.handler,u=a.map((function(e){var t=e.eventStoreId;return r[t]})),d=n[o],p=function(){var e=(0,v.Z)(g().mark((function e(t){var r,n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.formData,e.prev=1,e.next=4,s.apply(void 0,[r,u].concat((0,c.Z)(null!=d?d:[])));case 4:n=e.sent,console.log(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return(0,z.jsxs)(U.Z,{children:[(0,z.jsx)(V.Z,{expandIcon:D||(D=(0,z.jsx)(G.Z,{})),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,z.jsx)(H.Z,{children:o})}),(0,z.jsx)(Y.Z,{children:(0,z.jsx)(K.Z,{spacing:2,children:void 0!==i&&(0,z.jsx)(W,{schema:i,validator:J.Z,onSubmit:function(e){p(e)},noHtml5Validate:!0})})})]})},F=function(e){var t=e.commands,r=e.eventStoresById,n=e.contextsByCommandId;return(0,z.jsx)(K.Z,{spacing:2,children:t.map((function(e){return(0,z.jsx)($,{command:e,eventStoresById:r,contextsByCommandId:n},e.commandId)}))})};function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,Z.Z)(e);if(t){var o=(0,Z.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.Z)(this,r)}}var X=function(e){(0,y.Z)(r,e);var t=Q(r);function r(e){var n,o=e.eventStoreId;return(0,p.Z)(this,r),n=t.call(this,"Unable to find ReduxEventStorageAdapter for event store ".concat(o)),(0,l.Z)((0,m.Z)(n),"eventStoreId",void 0),n.eventStoreId=o,n}return(0,d.Z)(r)}((0,E.Z)(Error)),ee=["pageToken"];function te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var re,ne,oe,ie=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.pageToken,o=(0,u.Z)(r,ee),i=null!==(t=(0,a.v9)((function(t){var r=e.getStorageAdapter();if(!(r instanceof N))throw new X({eventStoreId:e.eventStoreId});var n=r.eventStoreSliceName,o=t[n];if(!o)throw new I({eventStoreSliceName:n});return o.aggregateIds})))&&void 0!==t?t:[],s=P({inputPageToken:n,inputOptions:o}),v=s.limit,d=s.initialEventAfter,p=s.initialEventBefore,f=s.reverse,g=s.exclusiveStartKey,h=(0,c.Z)(i).sort((function(e,t){return e.initialEventTimestamp>t.initialEventTimestamp?1:-1}));void 0!==d&&(h=h.filter((function(e){var t=e.initialEventTimestamp;return d<=t}))),void 0!==p&&(h=h.filter((function(e){return e.initialEventTimestamp<=p})));var m=h.map((function(e){return e.aggregateId}));if(!0===f&&(m=m.reverse()),void 0!==g){var y=m.findIndex((function(e){return e===g}));m=m.slice(y+1)}var S=m.length;void 0!==v&&(m=m.slice(0,v));var Z=void 0!==v&&S>v,E={limit:v,initialEventAfter:d,initialEventBefore:p,reverse:f,lastEvaluatedKey:m[m.length-1]};return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?te(Object(r),!0).forEach((function(t){(0,l.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({aggregateIds:m},Z?{nextPageToken:JSON.stringify(E)}:{})},ae=r(17377),se=r(92096),ce=r(7671),ue=r(5896),ve=r(74037),de=r(48047),pe=r.n(de),le=function(e){var t=e.src;return(0,z.jsx)(pe(),{src:"object"===(0,ve.Z)(t)&&null!==t?t:{src:t}})},fe=function(e){var t=new Date(e);return[t.toLocaleDateString(),t.toLocaleTimeString()].join(" - ")},ge=function(e){var t,r=e.eventStore,n=e.aggregateId,o=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.minVersion,i=n.maxVersion,s=n.reverse,c=n.limit,u=null!==(r=(0,a.v9)((function(r){var n=e.getStorageAdapter();if(!(n instanceof N))throw new X({eventStoreId:e.eventStoreId});var o=n.eventStoreSliceName,i=r[o];if(!i)throw new I({eventStoreSliceName:o});return i.eventsByAggregateId[t]})))&&void 0!==r?r:[];return void 0!==o&&(u=u.filter((function(e){return e.version>=o}))),void 0!==i&&(u=u.filter((function(e){return e.version<=i}))),!0===s&&(u=u.reverse()),void 0!==c&&(u=u.slice(0,c)),{events:u}}(r,n),s=o.events,u=null==(t=s[0])?void 0:t.timestamp,v=s.length,d=(0,i.useState)(s.length),p=(0,_.Z)(d,2),l=p[0],f=p[1],g=r.buildAggregate(s.filter((function(e){return e.version<=l})));return(0,z.jsx)(ae.Z,{elevation:2,children:(0,z.jsx)(se.Z,{children:(0,z.jsx)(ce.Z,{children:(0,z.jsxs)(K.Z,{spacing:2,children:[(0,z.jsx)(H.Z,{variant:"h5",component:"div",children:n}),(0,z.jsx)(H.Z,{color:"text.secondary",children:void 0!==u?fe(u):void 0}),(0,z.jsx)(ue.Z,{page:l,count:v,variant:"outlined",shape:"rounded",onChange:function(e,t){return f(t)}}),(0,z.jsx)(le,{src:g}),(0,z.jsxs)(U.Z,{variant:"outlined",sx:{backgroundColor:"#f9f9f9"},children:[re||(re=(0,z.jsx)(V.Z,{expandIcon:(0,z.jsx)(G.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,z.jsx)(H.Z,{children:"Events"})})),(0,z.jsx)(Y.Z,{children:(0,z.jsx)(K.Z,{spacing:2,children:(0,c.Z)(s).sort((function(e,t){return e.timestamp<t.timestamp?-1:1})).map((function(e,t){var r=e.type,o=e.payload,i=e.timestamp,a=e.version;return(0,z.jsxs)(U.Z,{variant:"outlined",children:[(0,z.jsx)(V.Z,{expandIcon:ne||(ne=(0,z.jsx)(G.Z,{})),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,z.jsx)(H.Z,{children:[a,r,fe(i)].join(" - ")})}),(0,z.jsx)(Y.Z,{children:(0,z.jsx)(le,{src:o})})]},"".concat(n,"_").concat(t))}))})})]})]})})})})},he=function(e){var t=e.eventStore,r=ie(t).aggregateIds;return(0,z.jsx)(K.Z,{spacing:2,children:r.map((function(e){return(0,z.jsx)(ge,{aggregateId:e,eventStore:t},e)}))})},me=function(e){var t=e.eventStoreIds,r=e.eventStoresById,n=(0,i.useState)(t[0]),o=(0,_.Z)(n,2),a=o[0],s=o[1];return(0,z.jsxs)(C.ZP,{value:a,children:[(0,z.jsx)(L.Z,{onChange:function(e,t){s(t)},"aria-label":"Event-store section",centered:!0,children:t.map((function(e){return(0,z.jsx)(q.Z,{label:e,value:e},e)}))}),t.map((function(e){return(0,z.jsx)(M.Z,{value:e,children:(0,z.jsx)(he,{eventStore:r[e]})},e)}))]})};!function(e){e.COMMANDS="COMMANDS",e.DB="DB"}(oe||(oe={}));var ye,Se=oe.COMMANDS,Ze=oe.DB,Ee=Se,xe=[Se,Ze],Ie=function(e){var t=e.commands,r=e.eventStoreIds,n=e.eventStoresById,o=e.contextsByCommandId,a=(0,i.useState)(Ee),s=(0,_.Z)(a,2),c=s[0],u=s[1];return(0,z.jsxs)(C.ZP,{value:c,children:[(0,z.jsx)(L.Z,{onChange:function(e,t){return u(t)},"aria-label":"Event Sourcing section",centered:!0,variant:"fullWidth",sx:{padding:"0 20%",backgroundColor:"#dddddd",boxShadow:"0px 3px 5px rgba(0,0,0,0.2)"},children:xe.map((function(e){return(0,z.jsx)(q.Z,{label:e,value:e},e)}))}),(0,z.jsx)(M.Z,{value:Se,children:(0,z.jsx)(F,{commands:t,eventStoresById:n,contextsByCommandId:o})}),(0,z.jsx)(M.Z,{value:Ze,children:(0,z.jsx)(me,{eventStoreIds:r,eventStoresById:n})})]})},be=function(e){var t=e.commands,r=e.eventStores,n=e.contextsByCommandId,o=T({eventStores:r}),i={},s=[];return r.forEach((function(e){s.push(e.eventStoreId),i[e.eventStoreId]=e})),(0,z.jsx)(a.zt,{store:o,children:(0,z.jsx)(Ie,{commands:t,eventStoreIds:s,eventStoresById:i,contextsByCommandId:n})})},je=(0,r(38646).Z)({palette:{background:{default:"#efefef"}}}),we=function(e){var t=e.commands,r=e.eventStores,i=e.contextsByCommandId;return(0,z.jsxs)(n.Z,{theme:je,children:[ye||(ye=(0,z.jsx)(o.ZP,{})),(0,z.jsx)(be,{commands:t,eventStores:r,contextsByCommandId:i})]})}}}]);